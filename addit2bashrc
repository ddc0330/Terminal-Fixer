# ===== Terminal Fixer Error Logger =====

# Project Path
export FIXER_PROJECT_DIR="/home/ddc/terminal-fixer"

# log DIR
export FIXER_LOG_DIR="$FIXER_PROJECT_DIR/logs"
mkdir -p "$FIXER_LOG_DIR"

# Makes this variable accessible to all subshells and functions
export FIXER_LOG_FILE="$FIXER_LOG_DIR/last_error.log"

function record_last_command() {
    export LAST_COMMAND="$BASH_COMMAND"
}

function capture_error() {
    local exit_status=$?
    if [ $exit_status -ne 0 ]; then
        local error_output=$(eval "$LAST_COMMAND" 2>&1 > /dev/null)
        {
            echo "[Command]      $LAST_COMMAND"
            echo "[Exit Code]    $exit_status"
            echo "[Error Output] $error_output"           
        } > "$FIXER_LOG_FILE"
    fi
}

trap 'record_last_command' DEBUG
trap 'capture_error' ERR

export PATH="$HOME/.local/bin:$PATH"